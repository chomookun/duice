/*!
 * duice - v0.2.64
 * git: https://gitbub.com/chomookun/duice
 * website: https://duice.chomookun.com
 * Released under the LGPL(GNU Lesser General Public License version 3) License
 */
var duice=function(e){"use strict";class t{static setNamespace(e){this.namespace=e}static getNamespace(){return this.namespace}static setTraceEnabled(e){sessionStorage.setItem(`${this.namespace}.traceEnabled`,JSON.stringify(e))}static isTraceEnabled(){const e=sessionStorage.getItem(`${this.namespace}.traceEnabled`);return!!e&&JSON.parse(e)}}t.namespace="duice";var s=window&&window.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(i,r){function l(e){try{o(n.next(e))}catch(e){r(e)}}function a(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,a)}o((n=n.apply(e,t||[])).next())}))};function n(e){return Array.isArray(e)}function i(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}function r(e){return e!==Object(e)}function l(e,t){globalThis.Object.defineProperty(e,"_proxy_target_",{value:t,writable:!0})}function a(e){return globalThis.Object.getOwnPropertyDescriptor(e,"_proxy_target_").value}function o(e,t){globalThis.Object.defineProperty(e,"_proxy_handler_",{value:t,writable:!0})}function h(e){return globalThis.Object.getOwnPropertyDescriptor(e,"_proxy_handler_").value}function c(e){return null!=globalThis.Object.getOwnPropertyDescriptor(e,"_proxy_target_")}function d(){let e=t.getNamespace();return`*[data-${e}-bind]:not([data-${e}-id])`}function u(e){e.querySelectorAll(d()).forEach((e=>{b(e,"id","_")}))}function m(e,t){try{let s=new Function(`return this.${t};`).call(e);if(s)return s}catch(e){}try{let e=new Function(`return ${t};`).call(null);if(e)return e}catch(e){}console.warn(`Object[${t}] is not found`)}function g(e,t,n){return s(this,void 0,void 0,(function*(){try{let s=[],i=[];for(let e in n)s.push(e),i.push(n[e]);return yield Function(...s,e).call(t,...i)}catch(t){throw console.error(e,t),t}}))}function p(e,t){return s(this,void 0,void 0,(function*(){let s=E(e,"if");if(s){let n=yield g(s,e,t);return e.hidden=!n,n}return!0}))}function y(e,t){return s(this,void 0,void 0,(function*(){let s=E(e,"execute");return s?yield g(s,e,t):null}))}function f(e,s){let n=t.getNamespace();return e.hasAttribute(`data-${n}-${s}`)}function E(e,s){let n=t.getNamespace();return e.getAttribute(`data-${n}-${s}`)}function b(e,s,n){let i=t.getNamespace();e.setAttribute(`data-${i}-${s}`,n)}function v(...e){t.isTraceEnabled()&&console.trace(e)}function x(e,t){if(console.assert(e,t),!e)throw new Error(t||"Assertion Failed")}class w{}class D{constructor(){this.observers=[],this.notifyEnabled=!0}addObserver(e){this.observers.push(e)}removeObserver(e){for(let t=0,s=this.observers.length;t<s;t++)if(this.observers[t]===e)return void this.observers.splice(t,1)}suspendNotify(){this.notifyEnabled=!1}resumeNotify(){this.notifyEnabled=!0}notifyObservers(e){this.notifyEnabled&&this.observers.forEach((t=>{t.update(this,e)}))}}class I extends D{constructor(e,t,s){super(),this.htmlElement=e,this.bindData=t,this.context=s,b(this.htmlElement,"id",this.generateId());let n=h(t);x(n,"ProxyHandler is not found"),this.addObserver(n),n.addObserver(this)}generateId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}getHtmlElement(){return this.htmlElement}getContext(){return this.context}getBindData(){return this.bindData}}class A{constructor(){this.eventListeners=new Map}addEventListener(e,t){let s=this.eventListeners.get(e);s||(s=[],this.eventListeners.set(e,s)),s.push(t)}removeEventListener(e,t){let s=this.eventListeners.get(e);if(s){let e=s.indexOf(t);e>=0&&s.splice(e,1)}}clearEventListeners(e){this.eventListeners.delete(e)}dispatchEventListeners(e){let t=this.eventListeners.get(e.constructor);return t?Promise.all(t.map((t=>t.call(this,e)))):Promise.resolve()}}class H{constructor(e){this.parentAttribute=e}}class C extends H{constructor(e){super(e),this.disabledProperties=new Map}setDisabledAll(e){this.disabledAll=e}isDisabledAll(){return this.disabledAll}setDisabled(e,t){this.disabledProperties.set(e,t)}isDisabled(e){return!!this.disabledAll||(this.disabledProperties.has(e)?this.disabledProperties.get(e):this.parentAttribute?this.parentAttribute.isDisabled(e):void 0)}}class L extends H{constructor(e){super(e),this.readonlyProperties=new Map}setReadonlyAll(e){this.readonlyAll=e}isReadonlyAll(){return this.readonlyAll}setReadonly(e,t){this.readonlyProperties.set(e,t)}isReadonly(e){return!!this.readonlyAll||(this.readonlyProperties.has(e)?this.readonlyProperties.get(e):this.parentAttribute?this.parentAttribute.isReadonly(e):void 0)}}var O=window&&window.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(i,r){function l(e){try{o(n.next(e))}catch(e){r(e)}}function a(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,a)}o((n=n.apply(e,t||[])).next())}))};class P extends D{constructor(e,t){var s,n;super(),this.readonlyAll=!1,this.readonly=new Set,this.disableAll=!1,this.disable=new Set,this.eventEnabled=!0,this.eventDispatcher=new A,this.target=e,this.parent=t,this.disabledAttribute=new C(null!==(s=null==t?void 0:t.disabledAttribute)&&void 0!==s?s:null),this.readonlyAttribute=new L(null!==(n=null==t?void 0:t.readonlyAttribute)&&void 0!==n?n:null)}setTarget(e){this.target=e}getTarget(){return this.target}setReadonlyAll(e){this.readonlyAttribute.setReadonlyAll(e),this.notifyObservers()}isReadonlyAll(){return this.readonlyAttribute.isReadonlyAll()}setReadonly(e,t){this.readonlyAttribute.setReadonly(e,t),this.notifyObservers()}isReadonly(e){return this.readonlyAttribute.isReadonly(e)}setDisableAll(e){this.disableAll=e,e||this.disable.clear(),this.notifyObservers(null)}isDisableAll(){return this.disableAll}setDisable(e,t){t?this.disable.add(e):this.disable.delete(e),this.notifyObservers(null)}isDisable(e){return this.disableAll||this.disable.has(e)}setDisabledAll(e){this.disabledAttribute.setDisabledAll(e),this.notifyObservers()}isDisabledAll(){return this.disabledAttribute.isDisabledAll()}setDisabled(e,t){this.disabledAttribute.setDisabled(e,t),this.notifyObservers()}isDisabled(e){return this.disabledAttribute.isDisabled(e)}addEventListener(e,t){this.eventDispatcher.addEventListener(e,t)}removeEventListener(e,t){this.eventDispatcher.removeEventListener(e,t)}clearEventListeners(e){this.eventDispatcher.clearEventListeners(e)}suspendEvent(){this.eventEnabled=!1}resumeEvent(){this.eventEnabled=!0}dispatchEventListeners(e){return O(this,void 0,void 0,(function*(){return this.eventEnabled?this.eventDispatcher.dispatchEventListeners(e).then((e=>null!=e&&e.length>0?!e.some((e=>!1===e)):null)):null}))}}class B{constructor(e){this.pattern=e}format(e){if(!e)return e;let t="",s=this.pattern.split(""),n=e.split(""),i=0;for(let e=0,r=s.length;e<r;e++){let r=s[e];if(t+="#"===r?n[i++]||"":r,i>=n.length)break}return t}parse(e){if(!e)return e;let t="",s=this.pattern.split(""),n=e.split(""),i=0;for(let e=0,r=s.length;e<r;e++){"#"===s[e]?t+=n[i++]||"":i++}return t}}class T{constructor(e){this.scale=0,this.scale=e}format(e){if(isNaN(Number(e)))return"";let t;e=Number(e),t=this.scale>0?String(e.toFixed(this.scale)):String(e);let s=/(^[+-]?\d+)(\d{3})/;for(;s.test(t);)t=t.replace(s,"$1,$2");return t}parse(e){if(!e)return null;if(1===e.length&&/[+-]/.test(e)&&(e+="0"),e=e.replace(/,/gi,""),isNaN(Number(e)))throw"NaN";let t=Number(e);return this.scale>0&&(t=Number(t.toFixed(this.scale))),t}}class S{constructor(e){this.patternRex=/yyyy|yy|MM|dd|HH|hh|mm|ss/gi,this.pattern=e}format(e){if(!e)return"";let t=new Date(e);return e=this.pattern.replace(this.patternRex,(function(e){switch(e){case"yyyy":return t.getFullYear();case"yy":return String(t.getFullYear()%1e3).padStart(2,"0");case"MM":return String(t.getMonth()+1).padStart(2,"0");case"dd":return String(t.getDate()).padStart(2,"0");case"HH":return String(t.getHours()).padStart(2,"0");case"hh":return String(t.getHours()<=12?t.getHours():t.getHours()%12).padStart(2,"0");case"mm":return String(t.getMinutes()).padStart(2,"0");case"ss":return String(t.getSeconds()).padStart(2,"0");default:return e}}))}parse(e){if(!e)return null;let t,s=new Date(0,0,0,0,0,0);for(;null!=(t=this.patternRex.exec(this.pattern));){let n=t[0],i=t.index,r=n.length,l=e.substr(i,r);switch(l=l.padEnd(r,"0"),n){case"yyyy":{let e=parseInt(l);s.setFullYear(e);break}case"yy":{let e=parseInt(l),t=100*Math.floor((new Date).getFullYear()/100)+e;s.setFullYear(t);break}case"MM":{let e=parseInt(l);s.setMonth(e-1);break}case"dd":{let e=parseInt(l);s.setDate(e);break}case"HH":{let e=parseInt(l);s.setHours(e);break}case"hh":{let e=parseInt(l);s.setHours(e>12?e+12:e);break}case"mm":{let e=parseInt(l);s.setMinutes(e);break}case"ss":{let e=parseInt(l);s.setSeconds(e);break}}}let n=-1*(new Date).getTimezoneOffset(),i=n>=0?"+":"-",r=function(e){return(e<10?"0":"")+e};return s.getFullYear()+"-"+r(s.getMonth()+1)+"-"+r(s.getDate())+"T"+r(s.getHours())+":"+r(s.getMinutes())+":"+r(s.getSeconds())+i+r(Math.floor(Math.abs(n)/60))+":"+r(Math.abs(n)%60)}}class N{static getFormat(e){let t,s;const n=e.match(/^([a-zA-Z_][a-zA-Z0-9_]*)\((.*)\)$/);if(!n)throw new Error(`Invalid format: ${e}`);switch(t=n[1],s=n[2].split(",").map((e=>e.trim().replace(/^['"]|['"]$/g,""))),t){case"string":return new B(s[0]);case"number":return new T(parseInt(s[0]));case"date":return new S(s[0]);default:throw new Error(`Unknown format: ${t}`)}}}class F extends I{constructor(e,t,s){super(e,t,s),this.property=E(e,"property");let n=E(e,"format");n&&(this.format=N.getFormat(n))}getProperty(){return this.property}getFormat(){return this.format}render(){let e=Object.assign({},this.getContext()),t=E(this.getHtmlElement(),"bind"),s=t.split(".");s.length>1?e[s[0]]=m(e,s[0]):e[t]=this.getBindData(),p(this.htmlElement,e).then((t=>{if(0==t)return;let s=h(this.getBindData());if(this.property){let e=s.getValue(this.property);this.setValue(e)}let n=s.isReadonly(this.property);this.setReadonly(n);let i=s.isDisabled(this.property);this.setDisable(i),y(this.htmlElement,e).then()}))}update(e,t){v("ObjectElement.update",e,t),e instanceof _&&this.render()}setValue(e){null!=e?(e=this.getFormat()?this.getFormat().format(e):e,this.htmlElement.innerText=e):this.htmlElement.innerText=""}getValue(){let e=this.htmlElement.innerText;return e=e&&e.trim().length>0?this.getFormat()?this.getFormat().parse(e):e:null,e}setReadonly(e){}setDisable(e){}getIndex(){let e=E(this.htmlElement,"index");if(e)return Number(e)}focus(){return!1}}class R{constructor(e,t){this.element=e,this.data=t}getElement(){return this.element}getData(){return this.data}}class V extends R{constructor(e,t,s,n,i){super(e,t),this.property=s,this.value=n,this.index=i}getProperty(){return this.property}getValue(){return this.value}getIndex(){return this.index}}class M extends R{constructor(e,t,s,n,i){super(e,t),this.property=s,this.value=n,this.index=i}getProperty(){return this.property}getValue(){return this.value}getIndex(){return this.index}}class _ extends P{constructor(e,t){super(e,t)}get(e,t,s){return Reflect.get(e,t,s)}set(e,t,s){return Reflect.set(e,t,s),this.notifyObservers(),!0}update(e,t){v("ObjectProxyHandler.update",e,t),e instanceof F&&t instanceof M&&this.dispatchEventListeners(t).then((s=>{if(!1===s)return void e.update(this,t);let n=e.getProperty(),i=e.getValue();this.setValue(n,i),this.notifyObservers(t);let r=new V(t.getElement(),t.getData(),t.getProperty(),t.getValue(),t.getIndex());this.dispatchEventListeners(r).then()}))}getValue(e){return e=e.replace(/\./g,"?."),new Function(`return this.${e};`).call(this.getTarget())}setValue(e,t){new Function("value",`this.${e} = value;`).call(this.getTarget(),t)}focus(e){this.observers.forEach((t=>{if(t instanceof F&&t.getProperty()===e&&t.focus())return!1}))}}class k extends R{constructor(e,t,s){super(e,t),this.index=s}getIndex(){return this.index}}class j extends R{constructor(e,t,s,n){super(e,t),this.fromIndex=s,this.toIndex=n}getFromIndex(){return this.fromIndex}getToIndex(){return this.toIndex}}class $ extends P{constructor(e,t){super(e,t)}get(e,t,s){let n=this;const i=e[t];return"function"==typeof i?["push","unshift"].includes(t)?function(){let i;"push"===t?i=s.length:"unshift"===t&&(i=0);let r=[];for(let e in arguments)r.push(arguments[e]);return n.insertItem(e,i,...r),e.length}:["splice"].includes(t)?function(){let t=arguments[0],s=arguments[1],i=[];for(let n=t;n<t+s;n++)i.push(e[n]);let r=[];for(let e=2;e<arguments.length;e++)r.push(arguments[e]);return s>0&&n.deleteItem(e,t,s),r.length>0&&n.insertItem(e,t,...r),i}:["pop","shift"].includes(t)?function(){let i;"pop"===t?i=s.length-1:"shift"===t&&(i=0);let r=[e[i]];return n.deleteItem(e,i),r}:i.bind(e):i}set(e,t,s){return Reflect.set(e,t,s),"length"===t&&this.notifyObservers(null),!0}update(e,t){if(e instanceof W){if(t instanceof k)return void(this.selectedItemIndex=t.getIndex());if(t instanceof j){let e=this.getTarget().splice(t.getFromIndex(),1)[0];this.getTarget().splice(t.getToIndex(),0,e)}}this.notifyObservers(t)}insertItem(e,t,...s){let n=h(e),i=a(e);s.forEach(((e,t)=>{if("object"==typeof e){let n=new Y(e);h(n),s[t]=n}})),i.splice(t,0,...s),n.notifyObservers()}deleteItem(e,t,s){let n=h(e),i=a(e),r=t,l=s?t+s:t+1;i.slice(r,l);let o=t,c=s||1;i.splice(o,c),n.notifyObservers()}selectItem(e){this.selectedItemIndex=e,this.notifyObservers()}getSelectedItemIndex(){return this.selectedItemIndex}}class z extends R{constructor(e,t,s,n){super(e,t),this.fromIndex=s,this.toIndex=n}getFromIndex(){return this.fromIndex}getToIndex(){return this.toIndex}}class J extends globalThis.Array{constructor(e,t){if(super(),e instanceof J)return e;let s=new $(e,t?h(t):null),n=new Proxy(e,s);l(n,e),o(n,s);let i=JSON.parse(JSON.stringify(e));return J.assign(n,i),J.save(n),n}static assign(e,t){let s=h(e);try{s.suspendEvent(),s.suspendNotify(),e.length=0;for(let n=0;n<t.length;n++){let r=t[n];if(i(r)){let t=new Y(r,e);e[n]=t,h(t).eventDispatcher=s.eventDispatcher,Y.setReadonlyAll(t,s.isReadonlyAll()),s.readonly.forEach((e=>{Y.setReadonly(t,e,!0)})),Y.setDisableAll(t,s.isDisableAll()),s.disable.forEach((e=>{Y.setDisable(t,e,!0)}))}}}finally{s.resumeEvent(),s.resumeNotify()}s.notifyObservers()}static clear(e){let t=h(e);try{t.suspendEvent(),t.suspendNotify(),e.length=0}finally{t.resumeEvent(),t.resumeNotify()}t.notifyObservers()}static save(e){let t=JSON.stringify(e);globalThis.Object.defineProperty(e,"_origin_",{value:t,writable:!0})}static reset(e){let t=JSON.parse(globalThis.Object.getOwnPropertyDescriptor(e,"_origin_").value);this.assign(e,t)}static setReadonly(e,t,s){h(e).setReadonly(t,s),e.forEach((e=>{Y.setReadonly(e,t,s)}))}static isReadonly(e,t){return h(e).isReadonly(t)}static setReadonlyAll(e,t){h(e).setReadonlyAll(t),e.forEach((e=>{Y.setReadonlyAll(e,t)}))}static isReadonlyAll(e){return h(e).isReadonlyAll()}static setDisable(e,t,s){h(e).setDisable(t,s),e.forEach((e=>{Y.setDisable(e,t,s)}))}static isDisable(e,t){return h(e).isDisable(t)}static setDisableAll(e,t){h(e).setDisableAll(t),e.forEach((e=>{Y.setDisableAll(e,t)}))}static isDisableAll(e){return h(e).isDisableAll()}static selectItem(e,t){return h(e).selectItem(t)}static getSelectedItemIndex(e){return h(e).getSelectedItemIndex()}static onItemSelecting(e,t){let s=h(e),n=k;s.clearEventListeners(n),s.addEventListener(n,t)}static onItemSelected(e,t){let s=h(e),n=k;s.clearEventListeners(n),s.addEventListener(n,t)}static onItemMoving(e,t){let s=h(e),n=j;s.clearEventListeners(n),s.addEventListener(n,t)}static onItemMoved(e,t){let s=h(e),n=z;s.clearEventListeners(n),s.addEventListener(n,t)}static onPropertyChanging(e,t){let s=h(e),n=M;s.clearEventListeners(n),s.addEventListener(n,t)}static onPropertyChanged(e,t){let s=h(e),n=V;s.clearEventListeners(n),s.addEventListener(n,t)}}class Y extends globalThis.Object{constructor(e,t){if(super(),e instanceof Y)return e;let s=new _(e,t?h(t):null),n=new Proxy(e,s);l(n,e),o(n,s);let i=JSON.parse(JSON.stringify(e));return Y.assign(n,i),Y.save(n),n}static assign(e,t){let s=h(e);try{s.suspendEvent(),s.suspendNotify();for(let l in t){let a=t[l];n(a)?c(e[l])?J.assign(e[l],a):(e[l]=new J(a,e),h(e[l]).addObserver(s)):i(a)?c(e[l])?Y.assign(e[l],a):(e[l]=new Y(a,e),h(e[l]).addObserver(s)):r(a)&&(e[l]=a)}}finally{s.resumeEvent(),s.resumeNotify()}s.notifyObservers(null)}static clear(e){let t=h(e);try{t.suspendEvent(),t.suspendNotify();for(let t in e){let s=e[t];Array.isArray(s)?J.clear(s):null==s||"object"!=typeof s?e[t]=null:Y.clear(s)}}finally{t.resumeEvent(),t.resumeNotify()}t.notifyObservers(null)}static save(e){let t=JSON.stringify(e);globalThis.Object.defineProperty(e,"_origin_",{value:t,writable:!0})}static reset(e){let t=JSON.parse(globalThis.Object.getOwnPropertyDescriptor(e,"_origin_").value);this.assign(e,t)}static setReadonly(e,t,s){h(e).setReadonly(t,s)}static isReadonly(e,t){return h(e).isReadonly(t)}static setReadonlyAll(e,t){h(e).setReadonlyAll(t)}static isReadonlyAll(e){return h(e).isReadonlyAll()}static setDisable(e,t,s){h(e).setDisable(t,s)}static isDisable(e,t){return h(e).isDisable(t)}static setDisableAll(e,t){h(e).setDisableAll(t)}static isDisableAll(e){return h(e).isDisableAll()}static setDisabledAll(e,t){h(e).setDisabledAll(t)}static isDisabledAll(e){return h(e).isDisabledAll()}static setDisabled(e,t,s){h(e).setDisabled(t,s)}static isDisabled(e,t){return h(e).isDisabled(t)}static focus(e,t){h(e).focus(t)}static onPropertyChanging(e,t){let s=h(e);s.clearEventListeners(M),s.addEventListener(M,t)}static onPropertyChanged(e,t){let s=h(e);s.clearEventListeners(V),s.addEventListener(V,t)}}class W extends I{constructor(e,t,s){super(e.cloneNode(!0),t,s),this.editable=!1,this.slot=document.createElement("slot"),this.itemHtmlElements=[],this.loop=E(e,"loop"),this.hierarchy=E(e,"hierarchy"),this.editable="true"===E(e,"editable"),this.selectedItemClass=E(e,"selected-item-class"),e.replaceWith(this.slot),u(e)}render(){var e;let t=this.getBindData();if(this.itemHtmlElements.forEach((e=>{e.parentNode.removeChild(e)})),this.itemHtmlElements.length=0,this.loop){let s=this.loop.split(","),n=s[0].trim(),i=null===(e=s[1])||void 0===e?void 0:e.trim();if(this.hierarchy){let e=this.hierarchy.split(","),s=e[0],r=e[1];const l=this;let a=function(e,o,h){for(let c=0;c<e.length;c++){const d=e[c];if(d[r]===o){let r=Object.assign({},l.getContext());r[n]=d,r[i]=new Y({index:c,count:c+1,size:t.length,first:0===c,last:t.length==c+1,depth:h}),l.createItemHtmlElement(c,d,r);let o=d[s];a(e,o,h+1)}}};a(t,null,0)}else for(let e=0;e<t.length;e++){let s=t[e],r=Object.assign({},this.getContext());r[n]=s,r[i]=new Y({index:e,count:e+1,size:t.length,first:0===e,last:t.length==e+1}),this.createItemHtmlElement(e,s,r)}}else{let e=this.getHtmlElement().cloneNode(!0),t=Object.assign({},this.getContext());K.initialize(e,this.getContext()),this.itemHtmlElements.push(e),this.slot.parentNode.insertBefore(e,this.slot),p(e,t),y(e,t)}}createItemHtmlElement(e,t,s){let n=this.getHtmlElement().cloneNode(!0);b(n,"index",e.toString());let i=this;this.editable&&(n.setAttribute("draggable","true"),n.addEventListener("dragstart",(e=>{let t=E(e.currentTarget,"index");e.dataTransfer.setData("text",t)})),n.addEventListener("dragover",(e=>{e.preventDefault(),e.stopPropagation()})),n.addEventListener("drop",(e=>{e.preventDefault(),e.stopPropagation();let t=this.getHtmlElement(),s=a(this.getBindData()),n=parseInt(e.dataTransfer.getData("text")),r=parseInt(E(e.currentTarget,"index")),l=new j(t,s,n,r);i.notifyObservers(l)}))),K.initialize(n,s,e),this.itemHtmlElements.push(n),this.slot.parentNode.insertBefore(n,this.slot),p(n,s).then(),y(n,s).then(),n.addEventListener("click",(t=>{this.selectedItemClass&&(this.itemHtmlElements.forEach((e=>{e.classList.remove(this.selectedItemClass)})),t.currentTarget.classList.add(this.selectedItemClass),t.stopPropagation());let s=this.getHtmlElement(),n=a(this.getBindData()),i=new k(s,n,e);this.notifyObservers(i)}))}update(e,t){if(v("ArrayElement.update",e,t),e instanceof $){if(t instanceof k){if(this.selectedItemClass){this.itemHtmlElements.forEach((e=>e.classList.remove(this.selectedItemClass))),t.getIndex()>=0&&this.itemHtmlElements.forEach((e=>{e.dataset.duiceIndex===t.getIndex().toString()&&e.classList.add(this.selectedItemClass)}))}return}this.render()}}}class X extends w{createElement(e,t,s){return new W(e,t,s)}}class U extends w{createElement(e,t,s){return this.doCreateElement(e,t,s)}}class Z extends w{createElement(e,t,s){return new F(e,t,s)}}class G{static register(e,t){t instanceof X?this.arrayElementFactories.set(e,t):t instanceof Z?this.objectElementFactories.set(e,t):t instanceof U&&this.customElementFactories.set(e,t),e.includes("-")&&globalThis.customElements.define(e,class extends HTMLElement{})}static getFactory(e,t,s){let n=e.tagName.toLowerCase();return this.customElementFactories.has(n)?this.customElementFactories.get(n):Array.isArray(t)?this.arrayElementFactories.has(n)?this.arrayElementFactories.get(n):this.defaultArrayElementFactory:this.objectElementFactories.has(n)?this.objectElementFactories.get(n):this.defaultObjectElementFactory}}G.defaultObjectElementFactory=new Z,G.defaultArrayElementFactory=new X,G.objectElementFactories=new Map,G.arrayElementFactories=new Map,G.customElementFactories=new Map;class K{static initialize(e,t,s){e.querySelectorAll(d()).forEach((n=>{var i,r;if(n instanceof HTMLElement){const l=n;if(!f(l,"id"))try{let e=E(l,"bind"),n=m(t,e);null===(r=null===(i=G.getFactory(l,n,t))||void 0===i?void 0:i.createElement(l,n,t))||void 0===r||r.render(),void 0!==s&&b(l,"index",s.toString())}catch(s){console.error(s,l,e,JSON.stringify(t))}}}))}}var q=window&&window.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(i,r){function l(e){try{o(n.next(e))}catch(e){r(e)}}function a(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,a)}o((n=n.apply(e,t||[])).next())}))};class Q extends F{constructor(e,t,s){super(e,t,s),this.editable=!1,this.closeButtonImg="data:image/svg+xml;base64,"+window.btoa('<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path opacity="0.4" d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" fill="#292D32"></path> <path d="M13.0594 12.0001L15.3594 9.70011C15.6494 9.41011 15.6494 8.93011 15.3594 8.64011C15.0694 8.35011 14.5894 8.35011 14.2994 8.64011L11.9994 10.9401L9.69937 8.64011C9.40937 8.35011 8.92937 8.35011 8.63938 8.64011C8.34938 8.93011 8.34938 9.41011 8.63938 9.70011L10.9394 12.0001L8.63938 14.3001C8.34938 14.5901 8.34938 15.0701 8.63938 15.3601C8.78938 15.5101 8.97937 15.5801 9.16937 15.5801C9.35937 15.5801 9.54937 15.5101 9.69937 15.3601L11.9994 13.0601L14.2994 15.3601C14.4494 15.5101 14.6394 15.5801 14.8294 15.5801C15.0194 15.5801 15.2094 15.5101 15.3594 15.3601C15.6494 15.0701 15.6494 14.5901 15.3594 14.3001L13.0594 12.0001Z" fill="#292D32"></path> </g></svg>'),this.originSrc=String(this.getHtmlElement().src),this.editable="true"===E(this.getHtmlElement(),"editable"),this.editable&&(this.getHtmlElement().style.cursor="pointer",this.getHtmlElement().addEventListener("click",(e=>{this.changeImage()})),this.clearButton=document.createElement("img"),this.clearButton.src=this.closeButtonImg,this.clearButton.style.cursor="pointer",this.clearButton.style.width="16px",this.clearButton.style.height="16px",this.clearButton.addEventListener("mouseout",(e=>{this.hideClearImageButton()}),!0),this.clearButton.addEventListener("click",(e=>{this.clearImage()})),this.getHtmlElement().addEventListener("mouseover",(e=>{this.showClearImageButton()}),!0),this.getHtmlElement().addEventListener("mouseout",(e=>{e.relatedTarget!==this.clearButton&&this.hideClearImageButton()}),!0));let n=E(this.getHtmlElement(),"size");if(n){let e=n.split(",");this.width=parseInt(e[0].trim()),this.height=parseInt(e[1].trim())}}showClearImageButton(){this.getHtmlElement().parentNode.insertBefore(this.clearButton,this.getHtmlElement().nextSibling),this.clearButton.style.position="absolute",this.clearButton.style.zIndex="100"}hideClearImageButton(){this.getHtmlElement().parentNode.removeChild(this.clearButton)}clearImage(){this.originSrc?this.getHtmlElement().src=this.originSrc:this.getHtmlElement().src=null;let e=this.getHtmlElement(),t=a(this.getBindData()),s=new M(e,t,this.getProperty(),this.getValue(),this.getIndex());this.notifyObservers(s)}changeImage(){let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/gif, image/jpeg, image/png");let t=this;e.addEventListener("change",(function(e){let s=new FileReader;this.files&&this.files[0]&&(s.addEventListener("load",(e=>q(this,void 0,void 0,(function*(){let s,n=e.target.result;s=t.width&&t.height?yield t.convertImage(n,t.width,t.height):yield t.convertImage(n),t.setValue(s);let i=t.getHtmlElement(),r=a(t.getBindData()),l=new M(i,r,t.getProperty(),t.getValue(),t.getIndex());t.notifyObservers(l)})))),s.readAsDataURL(this.files[0])),e.preventDefault(),e.stopPropagation()})),e.click()}convertImage(e,t,s){return new Promise((function(n,i){try{let i=document.createElement("canvas"),r=i.getContext("2d"),l=new Image;l.onload=function(){t&&s?(i.width=t,i.height=s,r.drawImage(l,0,0,t,s)):(i.width=l.naturalWidth,i.height=l.naturalHeight,r.drawImage(l,0,0));let e=i.toDataURL("image/png");n(e)},l.src=e}catch(e){i(e)}}))}setValue(e){this.getHtmlElement().src=e||this.originSrc}getValue(){let e=this.getHtmlElement().src;return e===this.originSrc?null:e}setReadonly(e){this.getHtmlElement().style.pointerEvents=e?"none":"unset"}setDisable(e){this.getHtmlElement().style.pointerEvents=e?"none":"unset"}}class ee extends Z{createElement(e,t,s){return new Q(e,t,s)}}G.register("img",new ee);class te extends F{constructor(e,t,s){super(e,t,s),this.getHtmlElement().addEventListener("change",(e=>{let t=this.getHtmlElement(),s=a(this.getBindData()),n=new M(t,s,this.getProperty(),this.getValue(),this.getIndex());this.notifyObservers(n)}),!0),this.getHtmlElement().setAttribute("autocomplete","off")}setValue(e){e=null!=e?this.getFormat()?this.getFormat().format(e):e:"",this.getHtmlElement().value=e}getValue(){let e=this.getHtmlElement().value;return e=e?this.getFormat()?this.getFormat().parse(e):e:null,e}setReadonly(e){this.getHtmlElement().readOnly=e}setDisable(e){e?this.getHtmlElement().setAttribute("disabled","disabled"):this.getHtmlElement().removeAttribute("disabled")}focus(){return this.getHtmlElement().focus(),!0}}class se extends te{constructor(e,t,s){super(e,t,s),this.getHtmlElement().setAttribute("type","text"),this.getHtmlElement().style.textAlign="right",this.getHtmlElement().addEventListener("keypress",(e=>{!1===/[\d|\.|,]/.test(e.key)&&e.preventDefault()}))}getValue(){let e=super.getValue();return Number(e)}}class ne extends te{constructor(e,t,s){super(e,t,s),this.trueValue=!0,this.falseValue=!1;let n=E(this.getHtmlElement(),"true-value");this.trueValue=n||this.trueValue;let i=E(this.getHtmlElement(),"false-value");this.falseValue=i||this.falseValue}setValue(e){e===this.trueValue?this.getHtmlElement().checked=!0:this.htmlElement.checked=!1}getValue(){return this.htmlElement.checked?this.trueValue:this.falseValue}disableClick(e){e.preventDefault()}setReadonly(e){e?this.getHtmlElement().addEventListener("click",this.disableClick):this.getHtmlElement().removeEventListener("click",this.disableClick)}}class ie extends te{constructor(e,t,s){super(e,t,s),this.dateFormat=new S("yyyy-MM-ddTHH:mm")}setValue(e){this.getHtmlElement().value=e?this.dateFormat.format(e):""}getValue(){let e=this.getHtmlElement().value;return e?new Date(e).toISOString():null}}class re extends te{constructor(e,t,s){super(e,t,s)}setValue(e){this.getHtmlElement().checked=this.getHtmlElement().value===e}getValue(){return this.getHtmlElement().value}setReadonly(e){this.getHtmlElement().style.pointerEvents=e?"none":""}}class le extends Z{createElement(e,t,s){switch(e.getAttribute("type")){case"number":return new se(e,t,s);case"checkbox":return new ne(e,t,s);case"radio":return new re(e,t,s);case"datetime-local":return new ie(e,t,s);default:return new te(e,t,s)}}}G.register("input",new le);class ae extends F{constructor(e,t,s){super(e,t,s),this.defaultOptions=[];for(let e=0;e<this.getHtmlElement().options.length;e++)this.defaultOptions.push(this.getHtmlElement().options[e]);this.option=E(this.getHtmlElement(),"option"),this.optionValueProperty=E(this.getHtmlElement(),"option-value-property"),this.optionTextProperty=E(this.getHtmlElement(),"option-text-property"),this.getHtmlElement().addEventListener("change",(()=>{let e=this.getHtmlElement(),t=a(this.getBindData()),s=new M(e,t,this.getProperty(),this.getValue(),this.getIndex());this.notifyObservers(s)}),!0)}render(){super.render(),this.updateOptions()}updateOptions(){let e=this.getHtmlElement().value;if(this.getHtmlElement().innerHTML="",this.defaultOptions.forEach((e=>{this.getHtmlElement().appendChild(e)})),this.option){m(this.getContext(),this.option).forEach((e=>{let t=document.createElement("option");t.value=e[this.optionValueProperty],t.appendChild(document.createTextNode(e[this.optionTextProperty])),this.getHtmlElement().appendChild(t)}))}this.getHtmlElement().value=e}setValue(e){if(this.getHtmlElement().value=e,!e)for(let e=0;e<this.getHtmlElement().options.length;e++){let t=this.getHtmlElement().options[e];if(!t.nodeValue){t.selected=!0;break}}}getValue(){let e=this.getHtmlElement().value;return(!e||e.trim().length<1)&&(e=null),e}setReadonly(e){this.getHtmlElement().style.pointerEvents=e?"none":""}setDisable(e){e?this.getHtmlElement().setAttribute("disabled","disabled"):this.getHtmlElement().removeAttribute("disabled")}}class oe extends Z{createElement(e,t,s){return new ae(e,t,s)}}G.register("select",new oe);class he extends F{constructor(e,t,s){super(e,t,s),this.getHtmlElement().addEventListener("change",(e=>{let t=this.getHtmlElement(),s=a(this.getBindData()),n=new M(t,s,this.getProperty(),this.getValue(),this.getIndex());this.notifyObservers(n)}),!0)}setValue(e){this.getHtmlElement().value=null!=e?e:""}getValue(){let e=this.getHtmlElement().value;return null!=e&&e.length>0?e:null}setReadonly(e){e?this.getHtmlElement().setAttribute("readonly","readonly"):this.getHtmlElement().removeAttribute("readonly")}setDisable(e){e?this.getHtmlElement().setAttribute("disabled","disabled"):this.getHtmlElement().removeAttribute("disabled")}}class ce extends Z{createElement(e,t,s){return new he(e,t,s)}}G.register("textarea",new ce);var de=window&&window.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(i,r){function l(e){try{o(n.next(e))}catch(e){r(e)}}function a(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,a)}o((n=n.apply(e,t||[])).next())}))};class ue{constructor(e){this.dialogElement=e;let t=this;this.dialogElement.style.position="absolute",this.dialogElement.style.left="0",this.dialogElement.style.right="0",this.dialogElement.style.overflowX="hidden",this.dialogElement.style.boxSizing="border-box",this.dialogElement.style.maxWidth="100%",this.header=document.createElement("div"),this.dialogElement.appendChild(this.header),this.header.style.display="flex",this.header.style.justifyContent="end",this.header.style.lineHeight="2rem",this.header.style.position="absolute",this.header.style.left="0",this.header.style.top="0",this.header.style.width="100%",this.header.style.cursor="pointer",this.header.onmousedown=function(e){let s=0,n=0,i=0,r=0;i=e.clientX,r=e.clientY,window.document.onmouseup=function(e){window.document.onmousemove=null,window.document.onmouseup=null},window.document.onmousemove=function(e){s=i-e.clientX,n=r-e.clientY,i=e.clientX,r=e.clientY,t.dialogElement.style.left=t.dialogElement.offsetLeft-s+"px",t.dialogElement.style.top=t.dialogElement.offsetTop-n+"px"}},this.closeButton=document.createElement("span"),this.closeButton.innerHTML="&#10005;",this.closeButton.style.fontFamily="monospace",this.closeButton.style.fontSize="large",this.closeButton.style.marginLeft="0.5rem",this.closeButton.style.marginRight="0.5rem",this.closeButton.addEventListener("click",(e=>{t.hide(),t.close()})),this.dialogElement.addEventListener("scroll",(()=>{const e=this.dialogElement.scrollTop;this.header.style.top=`${e}px`})),this.header.appendChild(this.closeButton),window.addEventListener("resize",(function(e){t.movePositionToCenter()}))}onOpening(e){return this.openingListener=e,this}onOpened(e){return this.openedListener=e,this}onClosing(e){return this.closingListener=e,this}onClosed(e){return this.closedListener=e,this}movePositionToCenter(){window.getComputedStyle(this.dialogElement),this.dialogElement.style.boxSizing="border-box";let e=this.dialogElement.offsetWidth,t=this.dialogElement.offsetHeight,s=window.scrollX,n=window.scrollY;this.dialogElement.style.left=Math.max(0,window.innerWidth/2-e/2)+s+"px",this.dialogElement.style.top=Math.max(0,window.innerHeight/3-t/3)+n+"px"}getDialogElement(){return this.dialogElement}show(){let e=window.scrollX,t=window.scrollY;window.document.body.appendChild(this.dialogElement),this.dialogElement.showModal(),window.scrollTo(e,t),this.movePositionToCenter()}hide(){this.dialogElement.close()}open(){return de(this,void 0,void 0,(function*(){if(this.openingListener&&0==this.openingListener.call(this))return;this.show(),this.openedListener&&this.openedListener.call(this);let e=this;return this.promise=new Promise((function(t,s){e.promiseResolve=t,e.promiseReject=s})),this.promise}))}close(...e){this.closingListener&&0==this.closingListener.call(this)||(this.closedListener&&this.closedListener.call(this),this.hide(),this.promiseResolve(...e))}}return globalThis.document&&document.addEventListener("DOMContentLoaded",(e=>{K.initialize(document.documentElement,{})})),globalThis.window&&["popstate","pageshow"].forEach((e=>{window.addEventListener(e,(t=>{("pageshow"!==e||t.persisted)&&document.dispatchEvent(new CustomEvent("DOMContentLoaded"))}))})),e.AlertDialog=class extends ue{constructor(e){super(document.createElement("dialog")),this.getDialogElement().style.padding="1rem",this.getDialogElement().style.minWidth="20rem",this.getDialogElement().style.textAlign="center",this.messagePre=document.createElement("pre"),this.messagePre.style.whiteSpace="pre-wrap",this.messagePre.style.marginTop="1rem",this.messagePre.style.marginBottom="1rem",this.messagePre.innerHTML=e,this.getDialogElement().appendChild(this.messagePre),this.confirmButton=document.createElement("button"),this.confirmButton.appendChild(document.createTextNode("OK")),this.confirmButton.style.width="5em",this.confirmButton.style.cursor="pointer",this.confirmButton.addEventListener("click",(e=>{this.confirm()})),this.getDialogElement().appendChild(this.confirmButton)}open(){let e=super.open();return this.confirmButton.focus(),e}confirm(){super.close(),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}close(){super.close(),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}},e.ArrayElement=W,e.ArrayElementFactory=X,e.ArrayProxy=J,e.Configuration=t,e.ConfirmDialog=class extends ue{constructor(e){super(document.createElement("dialog")),this.getDialogElement().style.padding="1rem",this.getDialogElement().style.minWidth="20rem",this.getDialogElement().style.textAlign="center",this.messagePre=document.createElement("pre"),this.messagePre.style.whiteSpace="pre-wrap",this.messagePre.style.marginTop="1rem",this.messagePre.style.marginBottom="1rem",this.messagePre.innerHTML=e,this.getDialogElement().appendChild(this.messagePre),this.cancelButton=document.createElement("button"),this.cancelButton.appendChild(document.createTextNode("Cancel")),this.cancelButton.style.width="5em",this.cancelButton.style.cursor="pointer",this.cancelButton.addEventListener("click",(e=>{this.cancel()})),this.getDialogElement().appendChild(this.cancelButton),this.getDialogElement().appendChild(document.createTextNode(" ")),this.confirmButton=document.createElement("button"),this.confirmButton.appendChild(document.createTextNode("OK")),this.confirmButton.style.width="5em",this.confirmButton.style.cursor="pointer",this.confirmButton.addEventListener("click",(e=>{this.confirm()})),this.getDialogElement().appendChild(this.confirmButton)}open(){let e=super.open();return this.confirmButton.focus(),e}close(...e){super.close(!1),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}confirm(){super.close(!0),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}cancel(){super.close(!1),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}},e.CustomElement=class extends I{constructor(e,t,s){super(e,t,s)}render(){this.doRender(this.getBindData()),p(this.getHtmlElement(),this.getContext()),K.initialize(this.getHtmlElement(),this.getContext()),y(this.getHtmlElement(),this.getContext())}update(e,t){e instanceof P&&this.doUpdate(e.getTarget())}},e.CustomElementFactory=U,e.Dialog=ue,e.ElementRegistry=G,e.ImgElementFactory=ee,e.Initializer=K,e.InputElementFactory=le,e.ItemMovedEvent=z,e.ItemMovingEvent=j,e.ItemSelectedEvent=class extends R{constructor(e,t,s){super(e,t),this.index=s}getIndex(){return this.index}},e.ItemSelectingEvent=k,e.ObjectElement=F,e.ObjectElementFactory=Z,e.ObjectProxy=Y,e.PromptDialog=class extends ue{constructor(e,t){super(document.createElement("dialog")),this.getDialogElement().style.padding="1rem",this.getDialogElement().style.minWidth="20rem",this.getDialogElement().style.textAlign="center",this.messagePre=document.createElement("pre"),this.messagePre.style.whiteSpace="pre-wrap",this.messagePre.style.marginTop="1rem",this.messagePre.style.marginBottom="1rem",this.messagePre.innerHTML=e,this.getDialogElement().appendChild(this.messagePre),this.promptInput=document.createElement("input"),this.promptInput.style.textAlign="center",this.promptInput.style.marginBottom="1rem",this.promptInput.style.width="100%",t&&(this.promptInput.type=t),this.getDialogElement().appendChild(this.promptInput),this.cancelButton=document.createElement("button"),this.cancelButton.appendChild(document.createTextNode("Cancel")),this.cancelButton.style.width="5em",this.cancelButton.style.cursor="pointer",this.cancelButton.addEventListener("click",(e=>{this.cancel()})),this.getDialogElement().appendChild(this.cancelButton),this.getDialogElement().appendChild(document.createTextNode(" ")),this.confirmButton=document.createElement("button"),this.confirmButton.appendChild(document.createTextNode("OK")),this.confirmButton.style.width="5em",this.confirmButton.style.cursor="pointer",this.confirmButton.addEventListener("click",(e=>{this.confirm(this.promptInput.value)})),this.getDialogElement().appendChild(this.confirmButton)}open(){let e=super.open();return this.promptInput.focus(),e}close(...e){super.close(),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}confirm(e){super.close(e),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}cancel(){super.close(),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}},e.PropertyChangedEvent=V,e.PropertyChangingEvent=M,e.ProxyHandler=P,e.SelectElementFactory=oe,e.TabFolder=class{constructor(){this.items=[]}addItem(e){e.setTabFolder(this),e.setTabIndex(this.items.length),this.items.push(e)}setActive(e){for(let t=0;t<this.items.length;t++)this.items[t].setActive(t===e)}},e.TabItem=class{constructor(e,t,s){this.button=e,this.content=t,this.listener=s,e.style.cursor="pointer";let n=this;e.addEventListener("click",(()=>{n.tabFolder.setActive(n.tabIndex)})),this.setActive(!1)}setTabFolder(e){this.tabFolder=e}setTabIndex(e){this.tabIndex=e}setActive(e){e?(this.button.style.opacity="unset",this.content.removeAttribute("hidden"),this.listener.call(this)):(this.button.style.opacity="0.5",this.content.setAttribute("hidden",String(!0)))}},e.TextareaElementFactory=ce,e.assert=x,e.findVariable=m,e.getElementAttribute=E,e.getElementQuerySelector=d,e.getProxyHandler=h,e.getProxyTarget=a,e.hasElementAttribute=f,e.isArray=n,e.isObject=i,e.isPrimitive=r,e.isProxy=c,e.markInitialized=u,e.runCode=g,e.runExecuteCode=y,e.runIfCode=p,e.setElementAttribute=b,e.setProxyHandler=o,e.setProxyTarget=l,e.trace=v,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=duice.min.js.map
